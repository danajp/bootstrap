---

- name: Provision a workstation
  hosts: all, localhost
  gather_facts: no

  vars:
    user:
      name: dana
      group: dana
      secrets:
        tarball: "{{ secrets_tarball | default(None) }}"
    ubuntu:
      release: cosmic

  pre_tasks:
    - name: Update OS packages
      apt:
        upgrade: dist
        update_cache: yes
      become: yes
    - name: Create user
      user:
        name: "{{ user.name }}"
        groups: sudo
        append: yes
      become: yes

  roles:
    - role: base
      tags: [base]
      become: yes

    - role: vpn
      tags: [vpn]
      become: yes

    - role: kubernetes
      tags: [kubernetes]
      become: yes

    - role: golang
      tags: [golang]
      become: yes

    - role: user
      tags: [user]
      become: yes
      become_user: "{{ user.name }}"

#    - role: work
#      tags: [work]

  post_tasks:
    - name: Add {{ user.name }} to docker group
      user:
        name: "{{ user.name }}"
        groups: docker
        append: yes
      become: yes
