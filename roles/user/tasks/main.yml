---

- name: Create secrets dir
  file:
    path: ~/secrets
    mode: 0700
    state: directory
  when: user.secrets.tarball

- name: Unpack secrets
  unarchive:
    src: "{{ user.secrets.tarball }}"
    dest: ~/secrets
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
  when: user.secrets.tarball

- name: Install secrets
  command: make clean install
  args:
    chdir: ~/secrets
  when: user.secrets.tarball

- name: Get dotfiles
  git:
    repo: git@github.com:danajp/dotfiles.git
    dest: ~/src/dotfiles
    accept_hostkey: yes
    update: yes

- name: Install dotfiles
  command: make clean install
  args:
    chdir: ~/src/dotfiles

- name: Install py3status
  shell: virtualenv ~/.i3/py3status-env && ~/.i3/py3status-env/bin/pip install py3status
  args:
    creates: ~/.i3/py3status-env/bin/py3status

- name: Get dotemacs
  tags: [emacs]
  git:
    repo: git@github.com:danajp/dotemacs.git
    dest: ~/src/dotemacs
    accept_hostkey: yes
    update: no

- name: Link emacs config
  tags: [emacs]
  file:
    src: ~/src/dotemacs
    dest: ~/.emacs.d
    state: link
    force: yes

- name: Install rbenv
  tags: [ruby, rbenv]
  git:
    repo: git@github.com:rbenv/rbenv.git
    dest: ~/.rbenv
    accept_hostkey: yes

- name: Install rbenv ruby-build
  tags: [ruby, rbenv]
  git:
    repo: git@github.com:rbenv/ruby-build.git
    dest: ~/.rbenv/plugins/ruby-build
    accept_hostkey: yes

- name: Install ruby version
  tags: [ruby, rbenv]
  shell: |
    . ~/.bashrc
    CC=/usr/bin/gcc-6 rbenv install {{ item }}
  args:
    executable: /bin/bash
    creates: "~/.rbenv/versions/{{ item }}"
  with_items: "{{ rbenv.install_versions }}"

- name: Install bundler for all ruby versions
  tags: [ruby, rbenv]
  shell: |
    . ~/.bashrc
    RBENV_VERSION={{ item }} gem install bundler
  args:
    executable: /bin/bash
    creates: "~/.rbenv/versions/{{ item }}/bin/bundle"
  with_items: "{{ rbenv.install_versions }}"

- name: Set global ruby version
  tags: [ruby, rbenv]
  shell: |
    . ~/.bashrc
    rbenv global {{ rbenv.global_version }}
  args:
    executable: /bin/bash
    creates: ~/.rbenv/version

- name: Solarized theme for gnome-terminal
  tags: [solarized]
  shell: |
    gconftool-2 --set "/apps/gnome-terminal/profiles/Default/use_theme_background" --type bool false
    gconftool-2 --set "/apps/gnome-terminal/profiles/Default/use_theme_colors" --type bool false
    gconftool-2 --set "/apps/gnome-terminal/profiles/Default/palette" --type string "#070736364242:#D3D301010202:#858599990000:#B5B589890000:#26268B8BD2D2:#D3D336368282:#2A2AA1A19898:#EEEEE8E8D5D5:#00002B2B3636:#CBCB4B4B1616:#58586E6E7575:#65657B7B8383:#838394949696:#6C6C7171C4C4:#9393A1A1A1A1:#FDFDF6F6E3E3"
    gconftool-2 --set "/apps/gnome-terminal/profiles/Default/background_color" --type string "#00002B2B3636"
    gconftool-2 --set "/apps/gnome-terminal/profiles/Default/foreground_color" --type string "#65657B7B8383"

- name: Install dropbox
  tags: [dropbox]
  shell: wget -O - "https://www.dropbox.com/download?plat=lnx.x86_64" | tar xzf -
  args:
    chdir: ~/
    creates: ~/.dropbox-dist/dropboxd
